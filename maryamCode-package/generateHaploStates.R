#' returns the first binary string with n 01 and m 1s
#' 
#' @param n the number of 0s
#' @param m the number of 1s
#' @author Maryam Ghareghani
#' @export
#' 

initialState = function(n, m)
{
  paste0(str_dup("0",n), str_dup("1",m))
}


#' computes the next binary status of a given status with equal number of 0s and 1s
#' 
#' @param currentState the current binary status
#' @author Maryam Ghareghani
#' @export
#' 

getNextState = function(currentState)#, n, m)
{
  nextState = currentState
  pos = str_locate_all(currentState, "01")[[1]][,1]
  if (length(pos) == 0)
  {
    return(FALSE) # can't be incremented
  }
  else
  {
    pos = pos[length(pos)] # last occurence of the pattern
    nextState = paste0(substr(nextState,1,pos-1),"10",substr(nextState,pos+2,nchar(nextState)))
    nextState = paste(nextState, collapse = "")
    
    if (pos + 1 < nchar(nextState))
    {
      c1 = str_count(substr(nextState, pos+2, nchar(nextState)),"1")
      c0 = nchar(nextState) - pos - 1 - c1
      nextState = paste0(substr(nextState,1,pos+1), initialState(c0,c1))
    }
  }
  nextState
}





#' generates all binary strings with n 0s and m 1s
#' 
#' @param n the number of 0s
#' @param m the number of 1s
#' @author Maryam Ghareghani
#' @export
#' 


allStatus = function(n,m)
{
  allStat = NULL
  status = initialState(n,m)
  
  while(status != FALSE)
  {
    allStat = c(allStat, status)
    status = getNextState(status)
  }
  
  allStat
}


#' Converts a binary status to an integer vector status
#' 
#' @param binaryStatus a binary string in which the number of 1s between every two consecutive zeros (or before the first zero or after the last zero) indicates a copy number
#' @author Maryam Ghareghani
#' @export
#' 

decodeStatus = function(binaryStatus)
{
  status = NULL
  pos = str_locate_all(binaryStatus, "0")[[1]][,1]
  pos = c(0, pos, nchar(binaryStatus)+1)
  
  for (i in 1:length(pos)-1)
  {
    status = c(status, pos[i+1]-pos[i]-1)
  }
  status
}


#' takes as input a haplotype state and returns the opposite haplotype state which has the same genotype
#' 
#' @param hapState a decoded haplotype state
#' @author Maryam Ghareghani
#' @export
#' 

sisterHaplotype = function(hapState)
{
  sisterHap = ""
  for (i in 1:(nchar(hapState)/4))
  {
    sisterHap = paste0(sisterHap, substr(hapState,i+2,i+3), substr(hapState,i,i+1))
  }
  sisterHap
}


#' remove or at least rename it later
#' computes the total normal CN and inverted CN status corresponding to the input decoded (non-binary) haplotype status
#' 
#'  Note that it doesn't compute the genotype (distribution of the CNs in the haplotypes)
#' @param haplotyeStatus a decoded (non binary) haplotype status
#' @author Maryam Ghareghani
#' @export
#' 

getGenotypeStatus = function(haplotypeStatus)
{
  hapStatus = as.integer(strsplit(haplotypeStatus,"")[[1]])
  genotypeStatus = NULL
  for (i in 1:(length(hapStatus)/4))
  {
    genotypeStatus = c(genotypeStatus, hapStatus[4*i-3]+hapStatus[4*i-1])
    genotypeStatus = c(genotypeStatus, hapStatus[4*i-2]+hapStatus[4*i])
  }
  
  paste(genotypeStatus, collapse = "")
}